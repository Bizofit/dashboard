<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Insights - Bizoforce Ecosystem</title>
    <link rel="stylesheet" href="../assets/css/dashboard.css">
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-logo">
            <div class="sidebar-logo-img">
                <div class="sidebar-logo-icon">B</div>
                <div class="sidebar-logo-text">Bizoforce</div>
            </div>
        </div>
        <nav class="sidebar-menu" id="sidebarMenu">
            <!-- Navigation items will be generated by JavaScript -->
        </nav>
    </aside>

    <!-- Top Bar -->
    <div class="top-bar">
        <div class="search-bar">
            <span class="search-icon">                üîîspan>
            <input type="text" class="search-input" placeholder="Search insights, visitors, companies...">
        </div>
        <div class="user-section">
            <div class="wallet">üí∞ <span id="walletBalance">0</span></div>
            <div class="notification-icon">
                üîî
                <div class="notification-badge">8</div>
            </div>
            <div class="user-avatar">AU</div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-container">
        <!-- Page Header -->
        <div class="page-header">
            <div>
                <h1 class="page-title">üéØ Business Insights & Lead Intelligence</h1>
                <p class="page-subtitle">Track who's viewing your business, identify decision-makers, and convert interest into opportunities</p>
            </div>
            <div style="display: flex; gap: 12px;">
                <button class="btn btn-secondary">üìä Export Report</button>
                <button class="btn btn-primary">üîî Set Alerts</button>
            </div>
        </div>

        <!-- Business Selector (shown when multiple companies exist) -->
        <div id="businessSelector" style="display: none; margin-bottom: 24px;">
                <div class="card" style="padding: 16px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-dark);">Select Business:</label>
                    <select id="selectedBusiness" class="form-select" style="max-width: 400px;" onchange="loadInsightsForBusiness()">
                        <option value="all">All Businesses</option>
                    </select>
                </div>
            </div>

            <!-- Future Development Banner -->
            <div style="background: linear-gradient(135deg, var(--warning), var(--accent-orange)); padding: 16px 24px; border-radius: 8px; margin-bottom: 24px; display: flex; align-items: center; gap: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                <div style="width: 48px; height: 48px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px;">üöß</div>
                <div style="flex: 1;">
                    <div style="font-size: 18px; font-weight: 700; color: white; margin-bottom: 4px;">üîÆ Feature Under Development</div>
                    <div style="font-size: 14px; color: white; opacity: 0.95;">This Business Insights feature will be implemented in future. It will track visitor analytics, company identification, intent signals, and decision-maker contact details using IP intelligence and behavioral tracking.</div>
                </div>
                <div style="background: white; padding: 6px 16px; border-radius: 6px; font-weight: 700; color: var(--warning); white-space: nowrap;">Coming Soon</div>
            </div>

            <!-- Current Business Display -->
            <div id="currentBusinessDisplay" style="display: none; margin-bottom: 16px; padding: 12px 16px; background: var(--blue-light); border-left: 4px solid var(--primary-blue); border-radius: 8px;">
                <div style="font-size: 14px; color: var(--text-gray); margin-bottom: 4px;">Viewing insights for:</div>
                <div style="font-size: 18px; font-weight: 700; color: var(--primary-blue);" id="currentBusinessName">All Businesses</div>
            </div>

            <!-- Key Metrics -->
            <div class="stats-cards-row" style="margin-bottom: 32px;">
                <div class="stats-card blue">
                                        <div class="stats-icon">üëÅÔ∏è</div>
                    <div class="stats-value" id="totalViews">2,847</div>
                    <div class="stats-label">Total Profile Views</div>
                    <div class="stats-change positive">√¢‚Ä†‚Äò 342 this week</div>
                </div>
                <div class="stats-card purple">
                    <div class="stats-icon">üè¢</div>
                    <div class="stats-value" id="uniqueCompanies">156</div>
                    <div class="stats-label">Unique Companies</div>
                    <div class="stats-change positive">78 new visitors</div>
                </div>
                <div class="stats-card orange">
                    <div class="stats-icon">üë§</div>
                    <div class="stats-value" id="decisionMakers">89</div>
                    <div class="stats-label">Decision Makers</div>
                    <div class="stats-change positive">42 high-intent leads</div>
                </div>
                <div class="stats-card green">
                    <div class="stats-icon">üìä</div>
                    <div class="stats-value" id="engagementScore">87%</div>
                    <div class="stats-label">Engagement Score</div>
                    <div class="stats-change positive">√¢‚Ä†‚Äò 12% improvement</div>
                </div>
            </div>

            <!-- Visitors Table -->
            <div class="card">
                <div style="padding: 24px; border-bottom: 1px solid var(--border-gray);">
                    <h2 style="font-size: 20px; margin-bottom: 8px;">Recent Visitor Activity</h2>
                    <p style="color: var(--text-gray); font-size: 14px;">High-intent visitors and decision-makers who viewed your business profile</p>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Visitor Name</th>
                                <th>Company</th>
                                <th>Title/Role</th>
                                <th>Intent Signal</th>
                                <th>Visit Details</th>
                                <th>Contact Info</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="visitorsTableBody">
                            <tr style="background: rgba(239, 68, 68, 0.05);">
                                <td>
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <div style="width: 36px; height: 36px; background: var(--primary-blue); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; color: white; font-size: 14px;">JD</div>
                                        <div>
                                            <div style="font-weight: 600;">Jennifer Davis</div>
                                            <div style="font-size: 11px; color: var(--text-gray);">Last seen: 2 hours ago</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div style="font-weight: 600;">Acme Corporation</div>
                                    <div style="font-size: 11px; color: var(--text-gray);">Enterprise Software | 2,500 employees</div>
                                    <div style="font-size: 11px; color: var(--text-gray);">San Francisco, CA</div>
                                </td>
                                <td>
                                    <span class="badge badge-success">VP of Operations</span>
                                    <div style="font-size: 11px; color: var(--text-gray); margin-top: 4px;">Decision Maker</div>
                                </td>
                                <td>
                                    <span class="badge badge-danger" style="display: block; margin-bottom: 4px;">üî• High Intent</span>
                                    <div style="font-size: 11px; color: var(--text-gray);">
                                        √¢‚Ç¨¬¢ Viewed pricing 3x<br>
                                        √¢‚Ç¨¬¢ Downloaded case study<br>
                                        √¢‚Ç¨¬¢ Visited team page
                                    </div>
                                </td>
                                <td>
                                    <div style="font-size: 12px;">
                                        <div style="margin-bottom: 2px;"><strong>8 page views</strong></div>
                                        <div style="color: var(--text-gray); font-size: 11px;">18 min session</div>
                                        <div style="color: var(--text-gray); font-size: 11px;">4 return visits</div>
                                    </div>
                                </td>
                                <td>
                                    <div style="font-size: 11px;">
                                        <div>üìß j.davis@acme.com</div>
                                        <div>üìû +1 (415) 555-0142</div>
                                        <div>üíº LinkedIn Verified</div>
                                    </div>
                                </td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn-icon success" title="Send Email">‚úâÔ∏è</button>
                                        <button class="btn-icon" title="View Profile">üëÅÔ∏è</button>
                                    </div>
                                </td>
                            </tr>
                            <tr style="background: rgba(249, 115, 22, 0.05);">
                                <td>
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <div style="width: 36px; height: 36px; background: var(--accent-orange); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; color: white; font-size: 14px;">MC</div>
                                        <div>
                                            <div style="font-weight: 600;">Michael Chen</div>
                                            <div style="font-size: 11px; color: var(--text-gray);">Last seen: 5 hours ago</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div style="font-weight: 600;">TechVision Inc.</div>
                                    <div style="font-size: 11px; color: var(--text-gray);">AI Solutions | 850 employees</div>
                                    <div style="font-size: 11px; color: var(--text-gray);">Seattle, WA</div>
                                </td>
                                <td>
                                    <span class="badge badge-warning">Director of IT</span>
                                    <div style="font-size: 11px; color: var(--text-gray); margin-top: 4px;">Influencer</div>
                                </td>
                                <td>
                                    <span class="badge badge-warning" style="display: block; margin-bottom: 4px;">√¢≈°¬° Medium Intent</span>
                                    <div style="font-size: 11px; color: var(--text-gray);">
                                        √¢‚Ç¨¬¢ Compared features<br>
                                        √¢‚Ç¨¬¢ Read 2 blog posts<br>
                                        √¢‚Ç¨¬¢ Checked FAQ
                                    </div>
                                </td>
                                <td>
                                    <div style="font-size: 12px;">
                                        <div style="margin-bottom: 2px;"><strong>5 page views</strong></div>
                                        <div style="color: var(--text-gray); font-size: 11px;">12 min session</div>
                                        <div style="color: var(--text-gray); font-size: 11px;">2 return visits</div>
                                    </div>
                                </td>
                                <td>
                                    <div style="font-size: 11px;">
                                        <div>üìß m.chen@techvision.io</div>
                                        <div>üìû +1 (206) 555-0198</div>
                                        <div>üíº LinkedIn Verified</div>
                                    </div>
                                </td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn-icon success" title="Send Email">‚úâÔ∏è</button>
                                        <button class="btn-icon" title="View Profile">üëÅÔ∏è</button>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <div style="width: 36px; height: 36px; background: var(--purple); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; color: white; font-size: 14px;">SJ</div>
                                        <div>
                                            <div style="font-weight: 600;">Sarah Johnson</div>
                                            <div style="font-size: 11px; color: var(--text-gray);">Last seen: 1 day ago</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div style="font-weight: 600;">GlobalTech Solutions</div>
                                    <div style="font-size: 11px; color: var(--text-gray);">Consulting | 350 employees</div>
                                    <div style="font-size: 11px; color: var(--text-gray);">New York, NY</div>
                                </td>
                                <td>
                                    <span class="badge" style="background: var(--blue-light); color: var(--primary-blue);">HR Manager</span>
                                    <div style="font-size: 11px; color: var(--text-gray); margin-top: 4px;">Research</div>
                                </td>
                                <td>
                                    <span class="badge" style="background: var(--bg-gray); color: var(--text-gray); display: block; margin-bottom: 4px;">üí§ Low Intent</span>
                                    <div style="font-size: 11px; color: var(--text-gray);">
                                        √¢‚Ç¨¬¢ Browsed homepage<br>
                                        √¢‚Ç¨¬¢ Quick visit
                                    </div>
                                </td>
                                <td>
                                    <div style="font-size: 12px;">
                                        <div style="margin-bottom: 2px;"><strong>3 page views</strong></div>
                                        <div style="color: var(--text-gray); font-size: 11px;">6 min session</div>
                                        <div style="color: var(--text-gray); font-size: 11px;">1 visit</div>
                                    </div>
                                </td>
                                <td>
                                    <div style="font-size: 11px;">
                                        <div>üìß s.johnson@globaltech.com</div>
                                        <div>üìû +1 (212) 555-0167</div>
                                        <div>üíº LinkedIn Verified</div>
                                    </div>
                                </td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn-icon success" title="Send Email">‚úâÔ∏è</button>
                                        <button class="btn-icon" title="View Profile">üëÅÔ∏è</button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Anonymous Visitor Tracking Section -->
            <div class="card" style="margin-top: 24px;">
                <div style="padding: 20px; border-bottom: 1px solid var(--border-color);">
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div>
                            <h2 style="font-size: 18px; font-weight: 700; color: var(--text-dark); margin-bottom: 4px;">üïµÔ∏è Anonymous Company Visitors</h2>
                            <p style="font-size: 14px; color: var(--text-gray);">Companies that visited your website without logged-in users (tracked via IP, domain, device fingerprint)</p>
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn btn-secondary">üìä Export Data</button>
                            <button class="btn btn-primary">üîç Identify Visitors</button>
                        </div>
                    </div>
                </div>

                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Company (IP/Domain)</th>
                                <th>Company Info</th>
                                <th>Pages Visited</th>
                                <th>Actions Taken</th>
                                <th>Visit Duration</th>
                                <th>First/Last Seen</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="anonymousVisitorsTableBody">
                            <tr style="background: rgba(239, 68, 68, 0.05);">
                                <td>
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <div style="width: 36px; height: 36px; background: var(--danger); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; color: white; font-size: 14px;">üè¢</div>
                                        <div>
                                            <div style="font-weight: 600;">Amazon Web Services</div>
                                            <div style="font-size: 11px; color: var(--text-gray);">IP: 52.218.45.192</div>
                                            <div style="font-size: 11px; color: var(--text-gray);">Domain: aws.amazon.com</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div style="font-size: 12px;">
                                        <div style="font-weight: 600;">Cloud Computing</div>
                                        <div style="color: var(--text-gray); font-size: 11px;">Seattle, WA, USA</div>
                                        <div style="color: var(--text-gray); font-size: 11px;">Fortune 500 Enterprise</div>
                                        <div style="margin-top: 4px;"><span class="badge badge-danger">üî• High Value Target</span></div>
                                    </div>
                                </td>
                                <td>
                                    <div style="font-size: 11px;">
                                        <div style="margin-bottom: 4px;"><strong>12 pages viewed</strong></div>
                                        <div style="color: var(--text-gray);">‚Ä¢ Homepage (3 times)</div>
                                        <div style="color: var(--text-gray);">‚Ä¢ Pricing Page (5 times)</div>
                                        <div style="color: var(--text-gray);">‚Ä¢ Enterprise Solutions</div>
                                        <div style="color: var(--text-gray);">‚Ä¢ API Documentation</div>
                                        <div style="color: var(--text-gray);">‚Ä¢ Case Studies (2 times)</div>
                                    </div>
                                </td>
                                <td>
                                    <div style="font-size: 11px;">
                                        <div style="color: var(--text-gray);">‚úì Downloaded whitepaper</div>
                                        <div style="color: var(--text-gray);">‚úì Watched demo video (82%)</div>
                                        <div style="color: var(--text-gray);">‚úì Used pricing calculator</div>
                                        <div style="color: var(--text-gray);">‚úì Clicked "Contact Sales" (didn't submit)</div>
                                        <div style="margin-top: 4px;"><span class="badge badge-danger">üéØ Purchase Intent: 87%</span></div>
                                    </div>
                                </td>
                                <td>
                                    <div style="font-size: 12px;">
                                        <div><strong>24 min 18 sec</strong></div>
                                        <div style="color: var(--text-gray); font-size: 11px; margin-top: 4px;">6 return visits</div>
                                        <div style="color: var(--text-gray); font-size: 11px;">Desktop (Chrome)</div>
                                    </div>
                                </td>
                                <td>
                                    <div style="font-size: 11px;">
                                        <div><strong>First:</strong> 3 days ago</div>
                                        <div><strong>Last:</strong> 4 hours ago</div>
                                        <div style="margin-top: 4px;"><span class="badge badge-warning">üîî Active</span></div>
                                    </div>
                                </td>
                                <td>
                                    <div class="action-buttons" style="flex-direction: column; gap: 4px;">
                                        <button class="btn-icon success" title="Research Company">üîç</button>
                                        <button class="btn-icon warning" title="Export Timeline">üìä</button>
                                        <button class="btn-icon" title="Add to CRM">üíº</button>
                                    </div>
                                </td>
                            </tr>
                            <tr style="background: rgba(249, 115, 22, 0.05);">
                                <td>
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <div style="width: 36px; height: 36px; background: var(--accent-orange); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; color: white; font-size: 14px;">üè¢</div>
                                        <div>
                                            <div style="font-weight: 600;">Microsoft Corporation</div>
                                            <div style="font-size: 11px; color: var(--text-gray);">IP: 40.112.72.205</div>
                                            <div style="font-size: 11px; color: var(--text-gray);">Domain: microsoft.com</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div style="font-size: 12px;">
                                        <div style="font-weight: 600;">Software & Cloud</div>
                                        <div style="color: var(--text-gray); font-size: 11px;">Redmond, WA, USA</div>
                                        <div style="color: var(--text-gray); font-size: 11px;">Fortune 500 Enterprise</div>
                                        <div style="margin-top: 4px;"><span class="badge badge-warning">‚ö° Medium Value</span></div>
                                    </div>
                                </td>
                                <td>
                                    <div style="font-size: 11px;">
                                        <div style="margin-bottom: 4px;"><strong>7 pages viewed</strong></div>
                                        <div style="color: var(--text-gray);">‚Ä¢ Homepage (2 times)</div>
                                        <div style="color: var(--text-gray);">‚Ä¢ Product Features</div>
                                        <div style="color: var(--text-gray);">‚Ä¢ Integration Options</div>
                                        <div style="color: var(--text-gray);">‚Ä¢ Customer Reviews</div>
                                        <div style="color: var(--text-gray);">‚Ä¢ About Us</div>
                                    </div>
                                </td>
                                <td>
                                    <div style="font-size: 11px;">
                                        <div style="color: var(--text-gray);">‚úì Read 3 blog posts</div>
                                        <div style="color: var(--text-gray);">‚úì Compared feature matrix</div>
                                        <div style="color: var(--text-gray);">‚úì Viewed team profiles</div>
                                        <div style="color: var(--text-gray);">‚úó No download/contact action</div>
                                        <div style="margin-top: 4px;"><span class="badge badge-warning">üéØ Purchase Intent: 54%</span></div>
                                    </div>
                                </td>
                                <td>
                                    <div style="font-size: 12px;">
                                        <div><strong>16 min 42 sec</strong></div>
                                        <div style="color: var(--text-gray); font-size: 11px; margin-top: 4px;">3 return visits</div>
                                        <div style="color: var(--text-gray); font-size: 11px;">Desktop (Edge)</div>
                                    </div>
                                </td>
                                <td>
                                    <div style="font-size: 11px;">
                                        <div><strong>First:</strong> 5 days ago</div>
                                        <div><strong>Last:</strong> Yesterday</div>
                                        <div style="margin-top: 4px;"><span class="badge" style="background: var(--bg-gray);">‚è∏Ô∏è Idle</span></div>
                                    </div>
                                </td>
                                <td>
                                    <div class="action-buttons" style="flex-direction: column; gap: 4px;">
                                        <button class="btn-icon success" title="Research Company">üîç</button>
                                        <button class="btn-icon warning" title="Export Timeline">üìä</button>
                                        <button class="btn-icon" title="Add to CRM">üíº</button>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <div style="width: 36px; height: 36px; background: var(--purple); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; color: white; font-size: 14px;">üè¢</div>
                                        <div>
                                            <div style="font-weight: 600;">Salesforce Inc.</div>
                                            <div style="font-size: 11px; color: var(--text-gray);">IP: 136.147.44.71</div>
                                            <div style="font-size: 11px; color: var(--text-gray);">Domain: salesforce.com</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div style="font-size: 12px;">
                                        <div style="font-weight: 600;">CRM & Cloud Software</div>
                                        <div style="color: var(--text-gray); font-size: 11px;">San Francisco, CA, USA</div>
                                        <div style="color: var(--text-gray); font-size: 11px;">Fortune 500 Enterprise</div>
                                        <div style="margin-top: 4px;"><span class="badge" style="background: var(--blue-light); color: var(--primary-blue);">üìä Research Phase</span></div>
                                    </div>
                                </td>
                                <td>
                                    <div style="font-size: 11px;">
                                        <div style="margin-bottom: 4px;"><strong>4 pages viewed</strong></div>
                                        <div style="color: var(--text-gray);">‚Ä¢ Homepage</div>
                                        <div style="color: var(--text-gray);">‚Ä¢ Pricing Page</div>
                                        <div style="color: var(--text-gray);">‚Ä¢ FAQ</div>
                                        <div style="color: var(--text-gray);">‚Ä¢ Contact Page (viewed only)</div>
                                    </div>
                                </td>
                                <td>
                                    <div style="font-size: 11px;">
                                        <div style="color: var(--text-gray);">‚úì Scrolled through pricing</div>
                                        <div style="color: var(--text-gray);">‚úì Read FAQ (4 questions)</div>
                                        <div style="color: var(--text-gray);">‚úó No engagement actions</div>
                                        <div style="margin-top: 4px;"><span class="badge" style="background: var(--bg-gray); color: var(--text-gray);">üéØ Purchase Intent: 28%</span></div>
                                    </div>
                                </td>
                                <td>
                                    <div style="font-size: 12px;">
                                        <div><strong>8 min 15 sec</strong></div>
                                        <div style="color: var(--text-gray); font-size: 11px; margin-top: 4px;">1 visit only</div>
                                        <div style="color: var(--text-gray); font-size: 11px;">Mobile (Safari)</div>
                                    </div>
                                </td>
                                <td>
                                    <div style="font-size: 11px;">
                                        <div><strong>First:</strong> 1 week ago</div>
                                        <div><strong>Last:</strong> 1 week ago</div>
                                        <div style="margin-top: 4px;"><span class="badge" style="background: var(--bg-gray);">üí§ Cold</span></div>
                                    </div>
                                </td>
                                <td>
                                    <div class="action-buttons" style="flex-direction: column; gap: 4px;">
                                        <button class="btn-icon success" title="Research Company">üîç</button>
                                        <button class="btn-icon warning" title="Export Timeline">üìä</button>
                                        <button class="btn-icon" title="Add to CRM">üíº</button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="../assets/js/dashboard.js"></script>
    <script>
        // @ts-nocheck
        localStorage.setItem('userType', 'company');
        generateNavigation('business-insights');

        // Load all companies and setup business selector
        function loadBusinessSelector() {
            const companies = [];
            const companyProfile = localStorage.getItem('companyProfile');
            
            if (companyProfile) {
                try {
                    const profile = JSON.parse(companyProfile);
                    companies.push(profile);
                } catch (e) {
                    console.error('Error parsing company profile:', e);
                }
            }

            const businessSelector = document.getElementById('businessSelector');
            const selectedBusiness = document.getElementById('selectedBusiness');
            const currentBusinessDisplay = document.getElementById('currentBusinessDisplay');
            const currentBusinessName = document.getElementById('currentBusinessName');

            // Show selector only if multiple businesses exist
            if (companies.length > 1) {
                businessSelector.style.display = 'block';
                currentBusinessDisplay.style.display = 'block';
                
                // Populate dropdown
                selectedBusiness.innerHTML = '<option value="all">All Businesses</option>';
                companies.forEach((company, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = company.companyName || `Company ${index + 1}`;
                    selectedBusiness.appendChild(option);
                });
            } else if (companies.length === 1) {
                // Single business - show name but no selector
                currentBusinessDisplay.style.display = 'block';
                currentBusinessName.textContent = companies[0].companyName || 'Your Business';
            }

            return companies;
        }

        // Load insights for selected business
        function loadInsightsForBusiness() {
            const selectedBusiness = document.getElementById('selectedBusiness').value;
            const currentBusinessName = document.getElementById('currentBusinessName');
            const companies = loadBusinessSelector();

            if (selectedBusiness === 'all') {
                currentBusinessName.textContent = 'All Businesses';
                // Load combined insights for all businesses
            } else {
                const businessIndex = parseInt(selectedBusiness);
                const company = companies[businessIndex];
                currentBusinessName.textContent = company.companyName || `Company ${businessIndex + 1}`;
                // Load insights for specific business
            }

            // TODO: Filter visitor data based on selected business
            console.log('Loading insights for:', selectedBusiness);
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadBusinessSelector();
            
            // Update wallet balance
            const companies = loadBusinessSelector();
            const totalCredits = companies.reduce((sum, company) => sum + (company.profileCredits || 0), 0);
            document.getElementById('walletBalance').textContent = totalCredits.toLocaleString();
        });
    </script>
</body>
</html>
