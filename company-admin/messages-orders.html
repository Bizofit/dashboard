<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Messages & Orders - Bizoforce Ecosystem</title>
    <link rel="stylesheet" href="../assets/css/dashboard.css">
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-logo">
            <div class="sidebar-logo-img">
                <div class="sidebar-logo-icon">B</div>
                <div class="sidebar-logo-text">Bizoforce</div>
            </div>
        </div>
        <nav class="sidebar-menu" id="sidebarMenu">
            <!-- Navigation items will be generated by JavaScript -->
        </nav>
    </aside>

    <!-- Top Bar -->
    <div class="top-bar">
        <div class="search-bar">
            <span class="search-icon">ğŸ”</span>
            <input type="text" class="search-input" placeholder="Search messages, orders, customers...">
        </div>
        <div class="user-section">
            <div class="wallet">ğŸ’° <span id="walletBalance">0</span></div>
            <div class="notification-icon">
                ğŸ””
                <div class="notification-badge">8</div>
            </div>
            <div class="user-avatar">AU</div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-container">
        <!-- Page Header -->
        <div class="page-header">
            <div>
                <h1 class="page-title">ğŸ“¬ Messages & Orders</h1>
                <p class="page-subtitle">Contact form submissions, order requests, and high-intent customer interactions</p>
            </div>
            <div style="display: flex; gap: 12px;">
                <button class="btn btn-secondary">ğŸ”” Mark All Read</button>
                <button class="btn btn-primary">ğŸ“§ Compose Message</button>
            </div>
        </div>

        <!-- Business Selector (shown when multiple companies exist) -->
        <div id="businessSelector" style="display: none; margin-bottom: 24px;">
                <div class="card" style="padding: 16px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-dark);">Select Business:</label>
                    <select id="selectedBusiness" class="form-select" style="max-width: 400px;" onchange="loadMessagesForBusiness()">
                        <option value="all">All Businesses</option>
                    </select>
                </div>
            </div>

            <!-- Future Development Banner -->
            <div style="background: linear-gradient(135deg, var(--warning), var(--accent-orange)); padding: 16px 24px; border-radius: 8px; margin-bottom: 24px; display: flex; align-items: center; gap: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                <div style="width: 48px; height: 48px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px;">ğŸš§</div>
                <div style="flex: 1;">
                    <div style="font-size: 18px; font-weight: 700; color: white; margin-bottom: 4px;">ğŸ”® Feature Under Development</div>
                    <div style="font-size: 14px; color: white; opacity: 0.95;">This Messages & Orders inbox will be implemented in future. It will capture contact form submissions, order requests, quote requests with automatic intent scoring (High/Medium/Low) and full conversation management with CRM integration.</div>
                </div>
                <div style="background: white; padding: 6px 16px; border-radius: 6px; font-weight: 700; color: var(--warning); white-space: nowrap;">Coming Soon</div>
            </div>

            <!-- Current Business Display -->
            <div id="currentBusinessDisplay" style="display: none; margin-bottom: 16px; padding: 12px 16px; background: var(--blue-light); border-left: 4px solid var(--primary-blue); border-radius: 8px;">
                <div style="font-size: 14px; color: var(--text-gray); margin-bottom: 4px;">Viewing messages for:</div>
                <div style="font-size: 18px; font-weight: 700; color: var(--primary-blue);" id="currentBusinessName">All Businesses</div>
            </div>

            <!-- Filter Tabs -->
            <div style="display: flex; gap: 12px; margin-bottom: 24px; border-bottom: 2px solid var(--border-color); padding-bottom: 12px;">
                <button class="btn btn-secondary" style="border-bottom: 3px solid var(--primary-blue); border-radius: 0;">All Messages (24)</button>
                <button class="btn btn-secondary" style="opacity: 0.7;">High Intent (8)</button>
                <button class="btn btn-secondary" style="opacity: 0.7;">Orders (5)</button>
                <button class="btn btn-secondary" style="opacity: 0.7;">Quotes (6)</button>
                <button class="btn btn-secondary" style="opacity: 0.7;">General (5)</button>
            </div>

            <!-- Inbox Summary Stats -->
            <div class="stats-cards-row" style="margin-bottom: 24px;">
                <div class="stats-card orange">
                    <div class="stats-icon">ğŸ“¬</div>
                    <div class="stats-value" id="totalMessages">24</div>
                    <div class="stats-label">Total Messages</div>
                    <div class="stats-change positive">8 unread</div>
                </div>
                <div class="stats-card red">
                    <div class="stats-icon">ğŸ”¥</div>
                    <div class="stats-value" id="highIntentLeads">8</div>
                    <div class="stats-label">High Intent Leads</div>
                    <div class="stats-change positive">3 today</div>
                </div>
                <div class="stats-card green">
                    <div class="stats-icon">ğŸ›’</div>
                    <div class="stats-value" id="orderRequests">5</div>
                    <div class="stats-label">Order Requests</div>
                    <div class="stats-change">2 pending</div>
                </div>
                <div class="stats-card blue">
                    <div class="stats-icon">ğŸ“„</div>
                    <div class="stats-value" id="quoteRequests">6</div>
                    <div class="stats-label">Quote Requests</div>
                    <div class="stats-change positive">4 this week</div>
                </div>
            </div>

            <!-- Messages Table -->
            <div class="card">
                <div style="padding: 24px; border-bottom: 1px solid var(--border-gray);">
                    <h2 style="font-size: 20px; margin-bottom: 8px;">Inbox</h2>
                    <p style="color: var(--text-gray); font-size: 14px;">Customer messages, order requests, and quote inquiries</p>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Status</th>
                                <th>Contact Name</th>
                                <th>Company</th>
                                <th>Type</th>
                                <th>Message Preview</th>
                                <th>Intent Score</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="messagesTableBody">
                            <tr style="background: rgba(239, 68, 68, 0.05); font-weight: 600;">
                                <td><span class="badge badge-warning">New</span></td>
                                <td>
                                    <div>
                                        <div style="font-weight: 700;">Robert Martinez</div>
                                        <div style="font-size: 11px; color: var(--text-gray);">r.martinez@enterprise.com</div>
                                    </div>
                                </td>
                                <td>Enterprise Solutions LLC</td>
                                <td><span class="badge badge-danger">ğŸ›’ Order</span></td>
                                <td>
                                    <div style="max-width: 300px;">
                                        <div>"We need 50 licenses for our team. Can you provide enterprise pricing and integration support?"</div>
                                    </div>
                                </td>
                                <td><span class="badge badge-danger">ğŸ”¥ High</span></td>
                                <td>2 hours ago</td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn-icon success" title="Reply">Ã¢Å“â€°Ã¯Â¸Â</button>
                                        <button class="btn-icon" title="View Full">ğŸ‘ï¸</button>
                                    </div>
                                </td>
                            </tr>
                            <tr style="background: rgba(249, 115, 22, 0.05);">
                                <td><span class="badge badge-warning">New</span></td>
                                <td>
                                    <div>
                                        <div style="font-weight: 600;">Lisa Wang</div>
                                        <div style="font-size: 11px; color: var(--text-gray);">l.wang@techcorp.io</div>
                                    </div>
                                </td>
                                <td>TechCorp Industries</td>
                                <td><span class="badge badge-warning">ğŸ“„ Quote</span></td>
                                <td>
                                    <div style="max-width: 300px;">
                                        <div>"Looking for a custom implementation quote for Q1 2025. Need onboarding support."</div>
                                    </div>
                                </td>
                                <td><span class="badge badge-warning">âš¡ Medium</span></td>
                                <td>5 hours ago</td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn-icon success" title="Reply">âœ‰ï¸</button>
                                        <button class="btn-icon" title="View Full">ğŸ‘ï¸</button>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td><span class="badge" style="background: var(--bg-gray);">Read</span></td>
                                <td>
                                    <div>
                                        <div style="font-weight: 600;">James Park</div>
                                        <div style="font-size: 11px; color: var(--text-gray);">j.park@startup.co</div>
                                    </div>
                                </td>
                                <td>Startup Innovations</td>
                                <td><span class="badge" style="background: var(--blue-light); color: var(--primary-blue);">ğŸ’¬ General</span></td>
                                <td>
                                    <div style="max-width: 300px;">
                                        <div>"What's your refund policy? We're evaluating different options."</div>
                                    </div>
                                </td>
                                <td><span class="badge" style="background: var(--bg-gray); color: var(--text-gray);">ğŸ’¤ Low</span></td>
                                <td>Yesterday</td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn-icon success" title="Reply">âœ‰ï¸</button>
                                        <button class="btn-icon" title="View Full">ğŸ‘ï¸</button>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td><span class="badge" style="background: var(--bg-gray);">Read</span></td>
                                <td>
                                    <div>
                                        <div style="font-weight: 600;">Amanda Foster</div>
                                        <div style="font-size: 11px; color: var(--text-gray);">a.foster@consulting.com</div>
                                    </div>
                                </td>
                                <td>Foster Consulting Group</td>
                                <td><span class="badge badge-danger">ğŸ›’ Order</span></td>
                                <td>
                                    <div style="max-width: 300px;">
                                        <div>"Need 20 seats ASAP. Can we get setup done by Friday?"</div>
                                    </div>
                                </td>
                                <td><span class="badge badge-danger">ğŸ”¥ High</span></td>
                                <td>2 days ago</td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn-icon success" title="Reply">âœ‰ï¸</button>
                                        <button class="btn-icon" title="View Full">ğŸ‘ï¸</button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="../assets/js/dashboard.js"></script>
    <script>
        // @ts-nocheck
        localStorage.setItem('userType', 'company');
        generateNavigation('messages-orders');

        // Load all companies and setup business selector
        function loadBusinessSelector() {
            const companies = [];
            const companyProfile = localStorage.getItem('companyProfile');
            
            if (companyProfile) {
                try {
                    const profile = JSON.parse(companyProfile);
                    companies.push(profile);
                } catch (e) {
                    console.error('Error parsing company profile:', e);
                }
            }

            const businessSelector = document.getElementById('businessSelector');
            const selectedBusiness = document.getElementById('selectedBusiness');
            const currentBusinessDisplay = document.getElementById('currentBusinessDisplay');
            const currentBusinessName = document.getElementById('currentBusinessName');

            // Show selector only if multiple businesses exist
            if (companies.length > 1) {
                businessSelector.style.display = 'block';
                currentBusinessDisplay.style.display = 'block';
                
                // Populate dropdown
                selectedBusiness.innerHTML = '<option value="all">All Businesses</option>';
                companies.forEach((company, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = company.companyName || `Company ${index + 1}`;
                    selectedBusiness.appendChild(option);
                });
            } else if (companies.length === 1) {
                // Single business - show name but no selector
                currentBusinessDisplay.style.display = 'block';
                currentBusinessName.textContent = companies[0].companyName || 'Your Business';
            }

            return companies;
        }

        // Load messages for selected business
        function loadMessagesForBusiness() {
            const selectedBusiness = document.getElementById('selectedBusiness').value;
            const currentBusinessName = document.getElementById('currentBusinessName');
            const companies = loadBusinessSelector();

            if (selectedBusiness === 'all') {
                currentBusinessName.textContent = 'All Businesses';
                // Load combined messages for all businesses
            } else {
                const businessIndex = parseInt(selectedBusiness);
                const company = companies[businessIndex];
                currentBusinessName.textContent = company.companyName || `Company ${businessIndex + 1}`;
                // Load messages for specific business
            }

            // TODO: Filter message data based on selected business
            console.log('Loading messages for:', selectedBusiness);
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadBusinessSelector();
            
            // Update wallet balance
            const companies = loadBusinessSelector();
            const totalCredits = companies.reduce((sum, company) => sum + (company.profileCredits || 0), 0);
            document.getElementById('walletBalance').textContent = totalCredits.toLocaleString();
        });
    </script>
</body>
</html>
